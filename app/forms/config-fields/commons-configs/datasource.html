<div class="form-group" ng-hide="ctrl.fieldEdit.meta.type == 'finder'">
  <div class="stock-separator">
    <label for="">Origem das opções</label>
  </div>

  <label for="">Tipo</label>
  <select class="form-control input-sm" 
          ng-model="ctrl.fieldEdit.dataSourceType" 
          ng-change="ctrl.selectDataSourcetype(ctrl.fieldEdit.dataSourceType)" 
          ng-blur="ctrl.validateConfigField('datasource_type')">
    <option value="">Selecione</option>
    <option value="E">Entidade</option>
    <option value="S">Serviço</option>
    <option value="O">Opções Editáveis</option>
  </select>
  <small class="text-danger" ng-if="ctrl.fieldEdit.error.datasource_type"> Selecione um tipo de datasource</small>
</div>

<!-- Datasource options -->
<div class="form-group" ng-show="ctrl.fieldEdit.dataSourceType == 'O'">
  <button type="button" class="btn btn-primary" ng-click="ctrl.openModalForConfig(ctrl.fieldEdit.meta, 'options', 'options')"> Editar Opções </button>
</div>

<!-- Datasource Finder -->
<div class="row" ng-show="ctrl.fieldEdit.dataSourceType == 'E' || ctrl.fieldEdit.meta.type == 'finder'">
  <div class="stock-separator" ng-if="ctrl.fieldEdit.meta.type == 'finder'">
    <label for="">Origem do Finder</label>
  </div>
  <div class="form-group">
    <div class="btn-group btn-block">
      <button class="btn btn-primary dropdown-toggle btn-block" data-toggle="dropdown">
        {[{ ctrl.moduleEntity.title || 'Módulos' }]} <i class="caret"></i>
      </button>
      <ul class="dropdown-menu btn-block">
        <li class="dropdown-header" ng-repeat-start="app in ctrl.apps track by $index" ng-bind="app.title"> </li>
        <li ng-repeat="mod in app.modules track by $index" ng-click="ctrl.getModuleEntity(mod.id, ctrl.fieldEdit.finder)">
          <a href="" ng-bind="mod.title"></a>
        </li>
        <li ng-repeat-end role="separator" class="divider" ng-hide="$last"></li>
      </ul>
    </div>
  </div>

  <div class="form-group">
    <label for="">Entidade</label>
    <input type="text" 
          class="form-control input-sm" 
          placeholder="Selecione" 
          ng-model="ctrl.fieldEdit.finder.entityName" 
          ng-blur="ctrl.selectEntityFinder(ctrl.fieldEdit.finder.entityName, ctrl.fieldEdit)"
          typeahead-on-select="ctrl.selectEntityFinder(ctrl.fieldEdit.finder.entityName, ctrl.fieldEdit)"
          uib-typeahead="entity.name as entity.name for entity in ctrl.entities | filter:{name: $viewValue}"
          typeahead-min-length="0" />
    <small class="text-danger" ng-if="ctrl.fieldEdit.error.datasource_finder_entityName">Selecione uma entidade</small>
  </div>

  <div class="form-group">
    <label for="">Finder:</label>
    <select class="form-control input-sm" 
            ng-change="ctrl.getFinder(ctrl.fieldEdit.finder.entityName, ctrl.fieldEdit.finder.key)"
            ng-blur="ctrl.validateConfigField('datasource_finder_key')"
            ng-model="ctrl.fieldEdit.finder.key"
            ng-options="finder.key as finder.title for finder in ctrl.finders">
    </select>
    <small class="text-danger" ng-if="ctrl.fieldEdit.error.datasource_finder_key">Selecione um finder</small>
  </div>

  <div class="form-group" ng-if="ctrl.fieldEdit.meta.type != 'finder'">
    <label for="">Campo</label>
    <select class="form-control input-sm" ng-model="ctrl.fieldEdit.finder.fieldIndex" ng-blur="ctrl.validateConfigField('datasource_finder_fieldIndex')">
      <option value="{[{ $index }]}" ng-repeat="field in ctrl.finder.fields">{[{ field.fieldName }]}</option>
    </select>
    <small class="text-danger" ng-if="ctrl.fieldEdit.error.datasource_finder_fieldIndex">Selecione um campo</small>
  </div>

  <div class="form-group" ng-if="ctrl.fieldEdit.meta.type == 'finder'">
    <label for="">Bind text</label>
    <input type="text" class="form-control input-sm" ng-model="ctrl.fieldEdit.finder.bindText" ng-blur="ctrl.validateConfigField('datasource_finder_bindText')">
    <small class="text-danger" ng-if="ctrl.fieldEdit.error.datasource_finder_bindText"></small>
  </div>

  <div class="row">
    <div class="stock-separator">
      <label for="">Dependências</label>
    </div>

    <div class="form-group">
      <label for="">Campos da entitidade do form</label>
      <select class="form-control input-sm" 
              multiple 
              ng-options="field.alias as (field.alias || field.label) for field in ctrl.allFields" 
              ng-model="ctrl.fieldEdit.bindDependencies">
      </select>
    </div>

    <div class="form-group" ng-if="ctrl.fieldEdit.dataSourceType == 'E'">
      <label for="">Referências</label>
      <select class="form-control input-sm" 
              multiple 
              ng-options="ref.bindForm as ref.fk for ref in ctrl.fieldEdit.depReferences"
              ng-model="ctrl.fieldEdit.bindReferences">
      </select>
    </div>
  </div>
</div>

<!-- Datasource Service -->
<div class="row" ng-show="ctrl.fieldEdit.dataSourceType == 'S'">
  <div class="form-group">
    <div class="btn-group btn-block">
      <button class="btn btn-primary dropdown-toggle btn-block" data-toggle="dropdown">
        {[{ ctrl.moduleEntity.title || 'Módulos' }]} <i class="caret"></i>
      </button>
      <ul class="dropdown-menu btn-block">
        <li class="dropdown-header" ng-repeat-start="app in ctrl.apps track by $index" ng-bind="app.title"> </li>
        <li ng-repeat="mod in app.modules track by $index" ng-click="ctrl.getSources(mod.id, ctrl.fieldEdit.serviceSource)">
          <a href="" ng-bind="mod.title"></a>
        </li>
        <li ng-repeat-end role="separator" class="divider" ng-hide="$last"></li>
      </ul>
    </div>
  </div>

  <div class="form-group">
    <label for="">Source Key:</label>
    <input type="text"
            class="form-control input-sm" 
            ng-model="ctrl.fieldEdit.serviceSource.key"
            ng-blur="ctrl.validateConfigField('datasource_service_key')"
            typeahead-min-length="0"
            uib-typeahead="source.key as source.key for source in ctrl.moduleSources">
   <small class="text-danger" ng-if="ctrl.fieldEdit.error.datasource_service_sourceKey">Selecione um sourceKey</small> 
  </div>
  
  <div class="form-group">
    <label for="">Método:</label>
    <input type="text" class="form-control input-sm" ng-model="ctrl.fieldEdit.serviceSource.method" ng-blur="ctrl.validateConfigField('datasource_service_method')">
    <small class="text-danger" ng-if="ctrl.fieldEdit.error.datasource_service_method">Selecione um método</small>
  </div>

  <div class="form-group">
    <label for="">Dependências</label>
    <select class="form-control input-sm" 
            multiple 
            ng-options="field.meta.bind as field.label for field in ctrl.selectFields" 
            ng-model="ctrl.fieldEdit.serviceSource.dependencies">
    </select>
  </div>
</div>